:rootDir:
:partialsDir: {rootDir}partials/
include::{rootDir}_attributes.adoc[]
= Migrating from TinyMCE 4 to TinyMCE 5.
:description: Guidance for migrating from TinyMCE 4 to TinyMCE 5.
:keywords: migration considerations premigration pre-migration
:title_nav: Migrating from TinyMCE 4

Most configuration changes in TinyMCE 5 only affect complex use cases, such as customized user interface components. The process for setting up a basic TinyMCE 5 instance is the same as TinyMCE 4.

This chapter describes the migration process and workarounds for customers using TinyMCE 4. It describes the settings that require updating prior to migration; and workaround procedures for deprecated, deleted, and updated features.

NOTE: For support related to migration, please contact https://support.tiny.cloud/hc/en-us/requests/new[Tiny support]. Open Source users: Please report issues on the https://github.com/tinymce/tinymce/[TinyMCE GitHub Repository].

[[contents]]
=== Contents

* <<editor-core,Editor-Core>>
* <<themes,Themes>>
* <<userinterfacecomponents,User Interface components>>
* <<plugins,Plugins>>

[[editor-core]]
== Editor-Core

To migrate the core TinyMCE editor to TinyMCE 5, review the following sections:

* <<clouddelivery,Cloud Delivery>>.
* <<editorchangestomethods,Editor: Changes to Methods>>.
* <<editorchangestosettings,Editor: Changes to Settings>>.
* <<browsersupportbackwardcompatibilityorquirksmode,Browser support: backward compatibility or quirks mode>>.

[[cloud-delivery]]
=== Cloud Delivery

To use TinyMCE 5 from the {cloudname}, include this script in your HTML page. Replace 'no-api-key' with link:{accountsignup}[your API key].

[source,html,subs="+attributes"]
----
<script src="{cdnurl}" referrerpolicy="origin"></script>
----

For information on using the latest development and testing builds, see: link:{rootDir}cloud-deployment-guide/editor-plugin-version.html[Cloud deployment guide - Specify editor & plugin versions].

[[editor-changes-to-api-methods]]
=== Editor: Changes to API Methods

All TinyMCE 4 API methods for creating UI components have been removed. New methods have been added for TinyMCE 5. For information on creating and customizing UI components, see: link:{rootDir}ui-components.html[User interface components].

[[editor-changes-to-settings]]
=== Editor: Changes to Settings

TinyMCE 5 includes the following changes to editor-core settings:

* <<neweditorsettings,New Editor settings>>
* <<changededitorsettings,Changed Editor settings>>
* <<removededitorsettings,Removed Editor settings>>
* <<deprecatededitorsettings,Deprecated Editor settings>>

[[new-editor-settings]]
==== New Editor settings

|===
| *Setting* | *Description*

| link:{rootDir}configure/content-appearance.html#custom_colors[`custom_colors`]
| *custom_colors* is `true` by default. Setting `custom_colors: false` removes the custom color picker in the color swatch.
|===

[[changed-editor-settings]]
==== Changed Editor settings

|===
| *Setting* | *TinyMCE 4* | *TinyMCE 5*

| link:{rootDir}configure/editor-appearance.html#height[`height`]
| Set the height of the editable area of the editor. +
Supported number values.
| Sets the overall height of the editor, including the menubar, toolbars, and statusbar. +
Supports numbers and strings. Assumes strings are a valid CSS value for height.

| link:{rootDir}configure/editor-appearance.html#width[`width`]
| Supported number values.
| Supports numbers and strings. Assumes strings are a valid CSS value for width.

| link:{rootDir}configure/editor-appearance.html#resize[`resize`]
| `true` by default.
| `true` by default if the `autoresize` plugin is not enabled. +
`false` by default if the `autoresize` plugin is enabled.
|===

[[removed-editor-settings]]
==== Removed Editor settings

* The `file_browser_callback` option has been removed for TinyMCE 5. The link:{url}/docs-4x/configure/file-image-upload/#file_browser_callback[`file_browser_callback`] option was used to add a file or image browser to TinyMCE. This option was deprecated in version 4.1.0 and replaced by link:{rootDir}configure/file-image-upload.html#file_picker_callback[`file_picker_callback`].
* link:{url}/docs-4x/configure/editor-appearance/#insert_button_items[`insert_button_items`] - the `insert_button_items` option was used to specify the toolbar items to display in the `insert` toolbar button menu. This toolbar button has been removed from TinyMCE 5. For a workaround, configure a custom toolbar button using the following configurations in the `tinymce.init`:

[source,js]
----
tinymce.init({
  ...
  toolbar: 'insert',
  setup: function (editor) {
    editor.ui.registry.addMenuButton('insert', {
      icon: 'plus',
      tooltip: 'Insert',
      fetch: (callback) => callback('image link | inserttable')
    });
  }
});
----

[[migrating-from-to]]
===== Migrating from `file_browser_callback` to `file_picker_callback`

link:{rootDir}configure/file-image-upload.html#file_picker_callback[`file_picker_callback`] provides a callback function, removing the requirement for an additional function to manually find and update the element or fire events. `file_picker_callback` can also update other fields by passing a second argument to update other fields in the dialog. For information on using `file_picker_callback`, see: link:{rootDir}configure/file-image-upload.html#file_picker_callback[Image & file upload options - `file_picker_callback`].

The following example shows the difference between the removed `file_browser_callback` setting and `file_picker_callback`, assuming that `browseFiles` is a function that opens an external file picker.

[[tinymce-4]]
====== TinyMCE 4 - `file_browser_callback`

[source,js]
----
tinymce.init({
  ...
  file_browser_callback_types: 'file image media',
  file_browser_callback: function (fieldId, value, type, win) {
    browseFiles(value, type, function (fileUrl) {
      win.document.getElementById(fieldId).value = fileUrl;
    });
  }
});
----

[[tinymce-5]]
====== TinyMCE 5 - `file_picker_callback`

[source,js]
----
tinymce.init({
  ...
  file_picker_types: 'file image media',
  file_picker_callback: function (callback, value, meta) {
    browseFiles(value, meta.filetype, function (fileUrl) {
      callback(fileUrl);
    });
  }
});
----

[[browser-support-backward-compatibility-or-quirks-mode]]
=== Browser support: backward compatibility or quirks mode

TinyMCE 5 does not support browsers running in Quirks or backward compatibility modes.

[[deprecated-editor-settings]]
==== Deprecated Editor settings

New platform detection functions were to the link:{rootDir}api/tinymce/tinymce.env.html[`Env` API] for {productname} 5.1, allowing for some older detection properties to be deprecated.

|===
| Deprecated Property | Alternative Property / Reason for Deprecation | Type | Original Description

| `opera`
| Use link:{rootDir}api/tinymce/tinymce.env.html#browserisopera[`browser.isOpera()`] instead.
| Boolean
| Constant that is `true` if the browser is Opera.

| `webKit`
| Use link:{rootDir}api/tinymce/tinymce.env.html#browserissafari[`browser.isSafari()`] or link:{rootDir}api/tinymce/tinymce.env.html#browserischrome[`browser.isChrome()`] instead.
| Boolean
| Constant that is `true` if the browser is WebKit (Safari/Chrome).

| `ie`
| Use link:{rootDir}api/tinymce/tinymce.env.html#browserversionmajor[`browser.version.major`] and link:{rootDir}api/tinymce/tinymce.env.html#browserisie[`browser.isIE()`] or link:{rootDir}api/tinymce/tinymce.env.html#browserisedge[`browser.isEdge()`] instead.
| Number
| Constant that is greater than zero if the browser is IE.

| `gecko`
| Use link:{rootDir}api/tinymce/tinymce.env.html#browserisfirefox[`browser.isFirefox()`] instead.
| Boolean
| Constant that is `true` if the browser is Gecko.

| `mac`
| Use link:{rootDir}api/tinymce/tinymce.env.html#osisosx[`os.isOSX()`] or link:{rootDir}api/tinymce/tinymce.env.html#osisios[`os.isiOS()`] instead.
| Boolean
| Constant that is `true` if the operating system is Mac OS.

| `iOS`
| Use link:{rootDir}api/tinymce/tinymce.env.html#osisios[`os.isiOS()`] instead.
| Boolean
| Constant that is `true` if the operating system is iOS.

| `android`
| Use link:{rootDir}api/tinymce/tinymce.env.html#osisandroid[`os.isAndroid()`] instead.
| Boolean
| Constant that is `true` if the operating system is android.

| `desktop`
| Use link:{rootDir}api/tinymce/tinymce.env.html#devicetypeisdesktop[`deviceType.isDesktop()`] instead.
| Boolean
| Constant that is `true` if the browser is running on a desktop device

| `contentEditable`
| All supported browsers now support content editable elements.
| Boolean
| Constant that is `true` if the browser supports editing.

| `caretAfter`
| All supported browsers now support placing carets after inline blocks.
| Boolean
| Returns `true`/`false` if the browser can or can't place the caret after a inline block like an image.

| `range`
| All supported browsers now support native DOM ranges.
| Boolean
| Constant that is `true` if the browser supports native DOM Ranges. IE 9+.

| `ceFalse`
| All supported browsers now support `contentEditable=false` regions.
| Boolean
| Constant that is `true` if the browser supports `contentEditable=false` regions.
|===

[[themes]]
== Themes

Most themes provided with TinyMCE 4 have been removed from TinyMCE 5 and are now combined in a new responsive theme called *Silver*. The `Silver` theme is enabled by default and contains a set of configurable UI components that can be used to replace the functionality of the TinyMCE 4 themes: Modern, Inline, and Inlite.

|===
| *Removed Theme* | *Replaced by*

| link:{url}/docs-4x/themes/modern/[Modern]
| Silver

| link:{url}/docs-4x/general-configuration-guide/use-tinymce-inline/[Modern inline]
| Silver link:{rootDir}general-configuration-guide/use-tinymce-inline.html[Inline]

| link:{url}/docs-4x/themes/inlite/[Inlite(Distraction-free Editor)]
| Silver (link:{rootDir}general-configuration-guide/use-tinymce-distraction-free.html[distraction-free] configuration)

| link:{url}/docs-4x/themes/mobile/[Mobile]
| Silver (link:{rootDir}mobile.html[responsive to small screen touch devices])
|===

[[inlite-theme-removed]]
=== Inlite theme removed

The link:{url}/docs-4x/themes/inlite/[Inlite] theme has been removed from TinyMCE 5.

The Inlite theme features are provided by the link:{rootDir}plugins/quickbars.html[Quick Toolbar (`quickbars`)] plugin for TinyMCE 5. The Inlite link:{url}/docs-4x/themes/inlite/#quicklink[`quicklink`] functionality is now provided by link:{rootDir}ui-components/contextform.html[Context Forms].

The following is an example of a TinyMCE 5 quickbars configuration:

[source,js]
----
{
  theme: 'silver',
  inline: true,
  toolbar: false,
  menubar: false,
  plugins: [ 'quickbars' ]
}
----
This will provide a similar but improved link:{rootDir}general-configuration-guide/use-tinymce-distraction-free.html[distraction-free] experience in TinyMCE 5.

[[modern-theme-removed]]
=== Modern theme removed

The link:{url}/docs-4x/themes/modern/[Modern] theme has been removed from TinyMCE 5.  The Modern theme's UI library link:{url}/docs-4x/api/tinymce.ui/[`tinymce.ui.*`] has also been removed. This change may impact integrations depending upon the level of customization.

[[themes-removed-events]]
=== Themes: Removed events

|===
| *Removed event* | *Description*

| BeforeRenderUi
| Fired before the UI was rendered.
|===

[[mobile-theme]]
=== Mobile theme

The {productname} 4 link:{rootDir}mobile.html#thelegacymobiletheme[Mobile theme] was deprecated in {productname} 5.1. The mobile-optimized editor is loaded on mobile devices. For information on the new mobile experience, see: link:{rootDir}mobile.html[{productname} mobile].

[[user-interface-components]]
== User Interface components

This section covers migrating UI components to TinyMCE 5

* <<removeduiconfigurationsettings,Removed UI configuration settings>>
* <<changeduiapimethodnamespace,Changed UI API method namespace>>
* <<customtoolbarbuttons,Custom toolbar buttons>>
* <<customcontexttoolbars,Custom context toolbars>>
* <<custommenuitems,Custom menu items>>
* <<customdialogs,Custom dialogs>>
* <<customurldialogs,Custom URL dialogs>>

[[removed-ui-configuration-settings]]
=== Removed UI configuration settings

All inline style configurations have been removed in TinyMCE 5 in favor of modern CSS. This affects all TinyMCE 4 UI component configurations.
link:{rootDir}advanced/creating-a-skin.html[Skins] should be used for custom styling in TinyMCE 5.

Removed style settings:
* `flex`
* `border`
* `layout` - Use the TinyMCE 5 UI component settings to compose a custom layout.
* `spacing`
* `padding`
* `align`
* `pack`
* `no-wrap`

[[changed-ui-api-method-namespace]]
=== Changed UI API method namespace

The API methods for registering UI components have moved. They are now part of link:{rootDir}api/tinymce.editor.ui/tinymce.editor.ui.registry.html[`tinymce.editor.ui.registry`].

[[changed-methods]]
==== Changed methods

The following methods have changed for TinyMCE 5:

|===
| *Old method* | *New method* | *Component*

| link:{url}/docs-4x/api/tinymce/tinymce.editor/#addbutton[`editor.addButton(identifier, configuration)`]
| link:{rootDir}api/tinymce.editor.ui/tinymce.editor.ui.registry.html#addbutton[`editor.ui.registry.addButton(identifier, configuration)`]
| link:{rootDir}ui-components/typesoftoolbarbuttons.html[Toolbar Buttons]

| link:{url}/docs-4x/api/tinymce/tinymce.editor/#addcontexttoolbar[`editor.addContextToolbar: (name, spec)`]
| link:{rootDir}api/tinymce.editor.ui/tinymce.editor.ui.registry.html#addcontexttoolbar[`editor.ui.registry.addContextToolbar`]
| link:{rootDir}ui-components/contexttoolbar.html[Context toolbar]

| link:{url}/docs-4x/api/tinymce/tinymce.editor/#addmenuitem[`editor.addMenuItem: (name, spec)`]
| link:{rootDir}api/tinymce.editor.ui/tinymce.editor.ui.registry.html#addmenuitem[`editor.ui.registry.addMenuItem`]
| link:{rootDir}ui-components/menuitems.html#basicmenuitems[Menu item]

| link:{url}/docs-4x/api/tinymce/tinymce.editor/#addsidebar[`editor.addSidebar: (name, spec)`]
| link:{rootDir}api/tinymce.editor.ui/tinymce.editor.ui.registry.html#addsidebar[`editor.ui.registry.addSidebar: (name, spec)`]
| link:{rootDir}ui-components/customsidebar.html[Sidebar]
|===

[[new-methods]]
==== New methods

The following new methods have been added for creating and using new components:

|===
| *New method* | *Description*

| `editor.ui.registry.addAutocompleter: (name, spec)`
| link:{rootDir}ui-components/autocompleter.html[Autocompleter]

| `editor.ui.registry.addContextForm: (name, spec)`
| link:{rootDir}ui-components/contextform.html[Context form]

| `editor.ui.registry.addContextMenu: (name, spec)`
| link:{rootDir}ui-components/contextmenu.html[Context menu]

| `editor.ui.registry.addMenuButton: (name, spec)`
| link:{rootDir}ui-components/typesoftoolbarbuttons.html#menubutton[Menu Button]

| `editor.ui.registry.addNestedMenuItem: (name, spec)`
| link:{rootDir}ui-components/menuitems.html#nestedmenuitems[Nested menu item]

| `editor.ui.registry.addSplitButton: (name, spec)`
| link:{rootDir}ui-components/typesoftoolbarbuttons.html#splitbutton[Split Button]

| `editor.ui.registry.addToggleButton: (name, spec)`
| link:{rootDir}ui-components/typesoftoolbarbuttons.html#togglebutton[Toggle Button]

| `editor.ui.registry.addToggleMenuItem: (name, spec)`
| link:{rootDir}ui-components/menuitems.html#togglemenuitems[Toggle menu item]

| `editor.ui.registry.addIcon: (name, svgData)`
| link:{rootDir}api/tinymce.editor.ui/tinymce.editor.ui.registry.html#addicon[Registers an SVG as an icon]

| `editor.ui.registry.getAll: ()`
| Returns an array of everything in the UI registry
|===

[[custom-toolbar-buttons]]
=== Custom toolbar buttons

The API methods for adding link:{rootDir}ui-components/toolbarbuttons.html#howtocreatecustomtoolbarbuttons[Custom toolbar buttons] have changed for TinyMCE 5. The methods have been moved from link:{url}/docs-4x/api/tinymce/tinymce.editor/[`editor.*`] to link:{rootDir}api/tinymce.editor.ui/tinymce.editor.ui.registry.html[`editor.ui.registry.*`]. The toolbar button type `listbox` has been removed and a toogle button type has been added. The button types available in TinyMCE 5 are:

* link:{rootDir}ui-components/typesoftoolbarbuttons.html#basicbutton[Basic button]
* link:{rootDir}ui-components/typesoftoolbarbuttons.html#togglebutton[Toggle button]
* link:{rootDir}ui-components/typesoftoolbarbuttons.html#splitbutton[Split button]
* link:{rootDir}ui-components/typesoftoolbarbuttons.html#menubutton[Menu button]

link:{url}/docs-4x/demo/custom-toolbar-listbox/[Listbox] toolbar buttons are not supported in TinyMCE 5. The recommended replacement toolbar button type is the link:{rootDir}ui-components/typesoftoolbarbuttons.html#splitbutton[*Split* button].

[[changed-toolbar-button-api-methods]]
==== Changed toolbar button API methods

The following methods for creating custom toolbar buttons have been moved for TinyMCE 5. For information on how to use the new methods, see: link:{rootDir}ui-components/toolbarbuttons.html[Toolbar buttons].

|===
| *Old method* | *New method*

| link:{url}/docs-4x/api/tinymce/tinymce.editor/#addbutton[`editor.addButton()`]
| link:{rootDir}api/tinymce.editor.ui/tinymce.editor.ui.registry.html#addbutton[`editor.ui.registry.addButton()`]

| link:{url}/docs-4x/api/tinymce/tinymce.editor/#addmenuitem[`editor.addMenuItem()`]
| link:{rootDir}api/tinymce.editor.ui/tinymce.editor.ui.registry.html#addmenuitem[`editor.ui.registry.addMenuItem()`]
|===

[[new-toolbar-button-api-methods]]
==== New toolbar button API methods

New methods have been added for creating common types of toolbar buttons.

|===
| *New method* | *Description*

| `editor.ui.registry.addToggleButton()`
| link:{rootDir}ui-components/menuitems.html#togglemenuitems[Adds a custom toolbar toggle button].

| `editor.ui.registry.addSplitButton()`
| link:{rootDir}ui-components/typesoftoolbarbuttons.html#splitbutton[Adds a custom toolbar split button].

| `editor.ui.registry.addMenuButton()`
| link:{rootDir}ui-components/typesoftoolbarbuttons.html#menubutton[Adds a custom toolbar menu button].
|===

For information on how to use these methods, see: link:{rootDir}ui-components/typesoftoolbarbuttons.html[Types of toolbar buttons].

[[changed-toolbar-api-methods]]
==== Changed Toolbar API methods

|===
| *Old method* | *New method* | *Description*

| link:{url}/docs-4x/advanced/creating-a-custom-button/#basicbutton[`onclick`]
| link:{rootDir}ui-components/typesoftoolbarbuttons.html#basicbutton[`onAction`]
| `onclick` is now `onAction`. `onAction` now has an API to provide helper functions to the user. For an example migration, see: <<migratingonclicktoonaction,Migrating onclick to onAction>>.

| link:{url}/docs-4x/advanced/creating-a-custom-button/#buttonoptions[`cmd`]
| link:{rootDir}ui-components/typesoftoolbarbuttons.html#basicbutton[`onAction`]
| `cmd` has been removed as a configuration option. Commands should be executed through `onAction` now. For an example migration, see: <<migratingcmdtoonaction,Migrating cmd to onAction>>.

| link:{url}/docs-4x/advanced/creating-a-custom-button/#togglebutton[`onpostrender`]
| link:{rootDir}ui-components/typesoftoolbarbuttons.html#onsetupexplanation[`onSetup`]
| `onpostrender` has been replaced with `onSetup`. For an example migration, see: <<migratingonpostrendertoonsetup,Migrating onpostrender to onSetup>>.
|===

[[migrating-onclick-to-onaction]]
===== Migrating onclick to onAction

link:{url}/docs-4x/advanced/creating-a-custom-button/#basicbutton[`onclick`] is now link:{rootDir}ui-components/typesoftoolbarbuttons.html#basicbutton[`onAction`]. The callback function given to `onAction` takes a `buttonApi` argument which is an object that contains helper functions.

For example:

[[tinymce-4-2]]
====== TinyMCE 4 - `onclick`

[source,js]
----
editor.addButton('mybutton', {
  text: "My Button",
  onclick: () => alert("My Button clicked!")
});
----

[[tinymce-5-2]]
====== TinyMCE 5 - `onAction`

[source,js]
----
editor.ui.registry.addButton('myButton', {
  text: 'My Button',
  onAction: (buttonApi) => alert('My Button clicked!')
});
----

Each type of toolbar button has a different set of API functions. For information using toolbar buttons, see: link:{rootDir}ui-components/typesoftoolbarbuttons.html[Types of toolbar buttons].

[[migrating-cmd-to-onaction]]
===== Migrating cmd to onAction

`cmd: string` has been removed. Commands should be executed using `onAction` instead.

For example:

[[tinymce-4-2]]
====== TinyMCE 4 - `cmd`

[source,js]
----
editor.addButton('mybutton', {
  text: "My Button",
  cmd: 'mceSave'
});
----

[[tinymce-5-2]]
====== TinyMCE 5 - `onAction`

[source,js]
----
editor.ui.registry.addButton('myButton', {
  text: 'My Button',
  onAction: (_) => editor.execCommand('mceSave')
});
----

[[migrating-onpostrender-to-onsetup]]
===== Migrating onpostrender to onSetup

`onpostrender` has been replaced with `onSetup` for menu and toolbar components.

There are 3 major changes:

* link:{url}/docs-4x/advanced/creating-a-custom-button/#togglebutton[`onpostrender`] was only processed when the editor was created, link:{rootDir}ui-components/typesoftoolbarbuttons.html#basicbuttonexampleandexplanation[`onSetup`] runs every time a component is rendered. For example: `onSetup` for a menu item is processed every time the menu rendered.
* `onSetup` has an API containing helper functions. Each link:{rootDir}ui-components/typesoftoolbarbuttons.html[type of toolbar button] has a different API.
* `onSetup` can be configured to return a function, which will be automatically be called on the teardown of the component, such as when a menu item's menu is closed.
 ** If a function should only be executed when the editor is first initialized, use the `editor.on('init', callback)` callback function.

CAUTION: If `onSetup` listens to any events using link:{rootDir}api/tinymce/tinymce.editor.html#on[`editor.on(eventName, callback)`], it should return a link:{rootDir}api/tinymce/tinymce.editor.html#off[`editor.off(eventName, callback)`] callback to unbind the event on tear down. Unless the event was `'init'`, `onSetup` returns `+(buttonApi) => ed.off(eventName, callback)+`.

For example:

[[tinymce-4-2]]
====== TinyMCE 4 - `onpostrender`

[source,js]
----
editor.addButton('currentdate', {
  icon: 'insertdatetime',
  tooltip: "Insert Current Date",
  onclick: insertDate,
  onpostrender: function monitorNodeChange() {
    var btn = this;
    editor.on('NodeChange', function(e) {
      btn.disabled(e.element.nodeName.toLowerCase() == 'time');
    });
  }
});
----

[[tinymce-5-2]]
====== TinyMCE 5 - `onSetup`

In this example, the button's API contains `+isDisabled: () => boolean+` and `+setDisabled: (state: boolean) => void+`.

[source,js]
----
editor.ui.registry.addButton('customDateButton', {
  icon: 'insert-time',
  tooltip: 'Insert Current Date',
  disabled: true,
  onAction: (_) => editor.insertContent(toTimeHtml(new Date())),
  onSetup: (buttonApi) => {
    const editorEventCallback = (eventApi) => buttonApi.setDisabled(eventApi.element.nodeName.toLowerCase() === 'time');
    editor.on('NodeChange', editorEventCallback);
    return (buttonApi) => editor.off('NodeChange', editorEventCallback);
  }
});
----

NOTE: The callback function given to `onSetup` takes a `buttonApi` argument which is an object that contains helper functions.

[[custom-context-toolbars]]
=== Custom context toolbars

The Context Toolbar accepts toolbar buttons to the editor using the link:{rootDir}ui-components/typesoftoolbarbuttons.html#basicbutton[`addButton`], link:{rootDir}ui-components/typesoftoolbarbuttons.html#togglebutton[`addToggleButton`], link:{rootDir}ui-components/typesoftoolbarbuttons.html#splitbutton[`addSplitButton`], or link:{rootDir}ui-components/typesoftoolbarbuttons.html#menubutton[`addMenuButton`] functions.

The API method for creating custom context toolbars in TinyMCE 5 has changed from link:{url}/docs-4x/api/tinymce/tinymce.editor/#addcontexttoolbar[`editor.addContextToolbar()`] to link:{rootDir}api/tinymce.editor.ui/tinymce.editor.ui.registry.html#addcontexttoolbar[`editor.ui.registry.addContextToolbar()`].

For information on Context Toolbars, see: link:{rootDir}ui-components/contexttoolbar[Context toolbar].

[[custom-menu-items]]
=== Custom menu items

The following configuration options have changed in the custom menu items for TinyMCE 5:
* link:{rootDir}api/tinymce.editor.ui/tinymce.editor.ui.registry.html#addmenuitem[`addMenuItem`] has a new configuration.
* A new method, link:{rootDir}api/tinymce.editor.ui/tinymce.editor.ui.registry.html#addnestedmenuitem[`addNestedMenuItem`] has been added to the options. The `addNestedMenuItem` is a method for creating menu items that have a sub-menu with one or more menu items.
* A new method, link:{rootDir}api/tinymce.editor.ui/tinymce.editor.ui.registry.html#addtogglemenuitem[`addToggleMenuItem`] has been added to the options. The `addToggleMenuItem` is a method for creating toggle menu items similar to the link:{rootDir}ui-components/typesoftoolbarbuttons.html#togglebutton[toggle toolbar button].
* The concept of `context` has been removed from menu item configurations. The link:{rootDir}configure/editor-appearance.html#menu[`menu` setting] provides this functionality for TinyMCE 5.

To add a custom item to a menu, use the `menu` setting. All items in a menu need to be declared in order to appear.

For example:

[source,js]
----
tinymce.init({
  selector: '#editor',
  plugins: 'help',
  menu: {
    help: { title: 'Help', items: 'help | myCustomMenuItem' }
  },
  menubar: 'file edit help',
  setup: (editor) => {
    editor.ui.registry.addMenuItem('myCustomMenuItem', {
      text: 'My Custom Menu Item',
      onAction: () => alert('Menu item clicked')
    });
  }
});
----

*More information*
* For information on using the `menu` setting, see: link:{rootDir}configure/editor-appearance.html#menu[User interface options - menu].
* For an example of the default menu items, see: link:{rootDir}configure/editor-appearance.html#examplethetinymcedefaultmenuitems[User interface options - Example: The TinyMCE Default Menu Items].
* For a list of the available menu controls provided by TinyMCE and the Tiny Premium Plugins, see: link:{rootDir}advanced/editor-control-identifiers.html#menucontrols[Editor control identifiers - Menu controls].

[[new-menu-item-methods]]
==== New menu item methods

|===
| *New method* | *Description*

| link:{rootDir}api/tinymce.editor.ui/tinymce.editor.ui.registry.html#addnestedmenuitem[`editor.ui.registry.addNestedMenuItem()`]
| Adds a menu item that opens a sub-menu.

| link:{rootDir}api/tinymce.editor.ui/tinymce.editor.ui.registry.html#addtogglemenuitem[`editor.ui.registry.addToggleMenuItem()`]
| Adds a custom toggle menu item.
|===

[[changed-menu-item-methods]]
==== Changed menu item methods

|===
| *Old method* | *New method* | *Description*

| link:{url}/docs-4x/api/tinymce/tinymce.editor/#addmenuitem[`editor.addMenuItem: (name, spec)`]
| link:{rootDir}api/tinymce.editor.ui/tinymce.editor.ui.registry.html#addmenuitem[`editor.ui.registry.addMenuItem()`]
| Adds a custom basic menu item.
|===

The following examples show custom menu item configurations in TinyMCE 4 and TinyMCE 5:

[[tinymce-4-example-custom-menu-item]]
==== TinyMCE 4 - example custom menu item

[source,js]
----
editor.addMenuItem('example', {
 text: 'My menu item',
 context: 'tools',
 onclick: () => editor.insertContent('Hello world!!');
});
----

[[tinymce-5-example-custom-menu-item]]
==== TinyMCE 5 - example custom menu item

[source,js]
----
editor.ui.registry.addMenuItem('example', {
 text: 'My menu item',
 onAction: () => editor.insertContent('Hello world!!');
});
----

For information on how to use these methods, see: link:{rootDir}ui-components/menuitems.html[Custom menu items].

[[custom-dialogs]]
=== Custom dialogs

Dialogs are still opened using the `editor.windowManager.open(config)` api, however a number of configuration options have changed.

[discrete#removed-dialog-settings]
===== Removed dialog settings:

|===
| *Removed setting* | *Description*

| link:{url}/docs-4x/advanced/creating-custom-dialogs/[`height`]
| The dialog component now uses CSS3 and a predefined `small`, `medium`, and `large` template to specify the dimensions.

| link:{url}/docs-4x/advanced/creating-custom-dialogs/[`width`]
| The dialog component now uses CSS3 and a predefined `small`, `medium`, and `large` template to specify the dimensions.

| `bodyType`
| `bodyType` has been merged into the `body` setting.

| `onpostrender`
| `onpostrender` has been removed for the dialog configuration. The dialog configuration now includes an `initialData` setting for providing the initial state and an API to fetch or update the data. Refer to link:{rootDir}ui-components/dialog.html#interactiveexampleusingredialconfigvoid[this] section for more information on how to configure `initialData`.

| link:{url}/docs-4x/advanced/creating-custom-dialogs/[`url`]
| URL dialogs now have their own API. For more information, see <<customurldialogs,`Custom URL dialogs`>>.
|===

[discrete#new-dialog-settings]
===== New dialog settings:

|===
| *New setting* | *Description*

| link:{rootDir}ui-components/dialog.html#configurationoptions[`initialData`]
| An object containing the initial value for the dialog components.

| link:{rootDir}ui-components/dialog.html#configurationoptions[`onCancel`]
| A callback that is called when the dialog is cancelled without submitting any changes.

| link:{rootDir}ui-components/dialog.html#configurationoptions[`onTabChange`]
| A callback that is called when switching tabs in a link:{rootDir}ui-components/dialogcomponents.html#tabpanel[TabPanel].
|===

[discrete#changed-dialog-settings]
===== Changed dialog settings:

|===
| *Old setting* | *New setting* | *Description*

| `onchange`
| link:{rootDir}ui-components/dialog.html#configurationoptions[`onChange`]
| `onChange` now takes a callback function which is passed an API helper function and data.
|===

NOTE: The `onchange` callback function provided within individual components has been removed. A single `onChange` callback function provides the same functionality for all components in TinyMCE 5.

[[tinymce-4-2]]
==== TinyMCE 4 - `onchange`

[source,js]
----
const config = {
  title: 'Insert Link',
  body: [
    {
      name: 'text',
      type: 'textbox',
      size: 40,
      label: 'Text to display',
      onchange () {
        data.text = this.value();
      }
    }
  ]
};
----

[[tinymce-5-2]]
==== TinyMCE 5 - `onChange`

[source,js]
----
const config = {
  title: 'Insert Link',
  body: {
    type: 'panel',
    items: [
      {
        name: 'text',
        type: 'input',
        label: 'Text to display'
      }
    ]
  },
  onChange (api, changeData) {
    if (changeData.name === 'text') {
      // Do something with the text to display changes
    }
  }
};
----

For information about the new dialog configuration, see the link:{rootDir}ui-components/dialog.html[Dialog] and link:{rootDir}ui-components/dialogcomponents.html[Dialog components] documentation.

[[changes-to-the-custom-dialog-api]]
==== Changes to the Custom dialog API

A redesign of the dialog API resulted in the following changes:

[[removed-custom-dialog-apis]]
===== Removed Custom dialog APIs

|===
| API | Type | Description

| link:{url}/docs-4x/api/tinymce/tinymce.windowmanager/#getparams[`tinymce.WindowManager.getParams()`]
| Method
| Returned the params of the last window open call. This was used in iframe based dialog to get params passed from the tinymce plugin.

| link:{url}/docs-4x/api/tinymce/tinymce.windowmanager/#getwindows[`tinymce.WindowManager.getWindows()`]
| Method
| Returned the currently opened window objects.

| link:{url}/docs-4x/api/tinymce/tinymce.windowmanager/#setparams[`tinymce.WindowManager.setParams()`]
| Method
| Set the params of the last opened window.

| `tinymce.WindowManager.windows`
| Property
| Returned an array of opened dialogs.
|===

[[changed-custom-dialog-api-methods]]
===== Changed Custom dialog API Methods

|===
| Method | Description | Change

| link:{rootDir}api/tinymce/tinymce.windowmanager.html#alert[`tinymce.WindowManager.alert()`]
| Creates an alert dialog.
| A window object is no-longer returned.

| link:{rootDir}api/tinymce/tinymce.windowmanager.html#confirm[`tinymce.WindowManager.confirm()`]
| Creates a "confirm" dialog.
| A window object is no-longer returned.

| link:{rootDir}api/tinymce/tinymce.windowmanager.html#close[`tinymce.WindowManager.close()`]
| Closes the top most window.
| Only closes dialogs created with `open()`.
|===

For information on the new Dialog API, see: link:{rootDir}ui-components/dialog.html#dialoginstanceapi[UI components - Dialog instance API].

[[custom-url-dialogs]]
=== Custom URL dialogs

The URL dialogs have moved from the `editor.windowManager.open()` API to the link:{rootDir}api/tinymce/tinymce.windowmanager.html#openurl[`editor.windowManager.openUrl()`] API. This provides clear separation of the two different types of dialogs in TinyMCE.

[discrete#removed-url-dialog-settings]
===== Removed URL dialog settings:

|===
| *Old setting* | *New setting* | *Description*

| `file`
| link:{rootDir}ui-components/urldialog.html#configurationoptions[`url`]
| The `file` setting has been removed in TinyMCE 5 and replaced with `url`.
|===

[discrete#new-url-dialog-settings]
===== New URL dialog settings:

|===
| *New setting* | *Description*

| link:{rootDir}ui-components/urldialog.html#configurationoptions[`onCancel`]
| A callback that is called when the dialog is cancelled without submitting any changes.

| link:{rootDir}ui-components/urldialog.html#configurationoptions[`onMessage`]
| A callback that is called when the dialog receives a message via the browser `window.postMessage` API.
|===

[[tinymce-4-2]]
==== TinyMCE 4 - `windowManager.open()`

[source,js]
----
editor.windowManager.open({
  title: 'URL Dialog Demo',
  url: 'http://mysite.com/external-page.html'
});
----

[[tinymce-5-2]]
==== TinyMCE 5 - `windowManager.openUrl()`

[source,js]
----
editor.windowManager.openUrl({
  title: 'URL Dialog Demo',
  url: 'http://mysite.com/external-page.html'
});
----

For information about the new URL dialog configuration, see: link:{rootDir}ui-components/urldialog.html[URL dialog].

[[plugins]]
== Plugins

The following section covers the changed and removed plugin features for TinyMCE 5.

* <<removedpluginsettings,Removed plugin settings>>
* <<changedpluginsettings,Changed plugin settings>>
* <<changedplugins,Changed plugins>>
* <<spellcheckerplugin,Spellchecker plugin>>
* <<tableplugin,Table plugin>>

[[removed-plugin-settings]]
=== Removed plugin settings

The `height` and `width` settings have been removed from plugin dialogs. The dialog component now uses CSS3 and a predefined `small`, `medium`, and `large` template to specify the dimensions.

The following plugins from TinyMCE 4 do not require height or width options in TinyMCE 5:

* link:{rootDir}plugins/code.html[Code]
* link:{rootDir}plugins/codesample.html[Codesample]
* link:{rootDir}plugins/preview.html[Preview]
* link:{rootDir}plugins/template.html[Template]

[[changed-plugin-settings]]
=== Changed plugin settings

|===
| *TinyMCE 4* | *TinyMCE 5*

| link:{url}/docs-4x/plugins/autoresize/#autoresize_min_height[`autoresize_min_height`]
| link:{rootDir}configure/editor-appearance.html#min_height[`min_height`]

| link:{url}/docs-4x/plugins/autoresize/#autoresize_max_height[`autoresize_max_height`]
| link:{rootDir}configure/editor-appearance.html#max_height[`max_height`]

| link:{url}/docs-4x/plugins/textcolor/#textcolor_cols[`textcolor_cols`]
| link:{rootDir}configure/content-appearance.html#color_cols[`color_cols`]

| link:{url}/docs-4x/plugins/textcolor/#textcolor_map[`textcolor_map`]
| link:{rootDir}configure/content-appearance.html#color_map[`color_map`]
|===

[[changed-plugins]]
=== Changed plugins

These features have either changed or have been deleted in TinyMCE 5.

|===
| *Plugin name* | *Description*

| link:{url}/docs-4x/plugins/contextmenu/[ContextMenu]
| New API. See the link:{rootDir}ui-components/contextmenu.html[docs].

| link:{url}/docs-4x/plugins/colorpicker/[ColorPicker]
| Moved to the core. See the link:{rootDir}configure/content-appearance/#color_picker}}[docs].

| link:{url}/docs-4x/plugins/textcolor/[TextColor]
| The `textcolor` plugin was removed and this setting is has been replaced by link:{rootDir}configure/content-appearance.html#text_color[`text_color`] in TinyMCE 5.
|===

[[custom-context-menus]]
==== Custom context menus

The link:{url}/docs-4x/plugins/contextmenu/[Context menus] are part of the core and enabled by default in TinyMCE 5. TinyMCE 5 supports adding registered menu items and allows plugins to register "sections" of the context menu. These sections show or hide depending on the cursor position when the context menu is opened.

For information on using context menus and the default context menu configuration, see: link:{rootDir}ui-components/contextmenu.html[UI components - Context menu].

[[new-context-menu-methods]]
===== New context menu methods:

|===
| *New method* | *Description*

| link:{rootDir}api/tinymce.editor.ui/tinymce.editor.ui.registry.html#addcontextmenu[`editor.ui.registry.addContextMenu()`]
| Adds a custom context menu.
|===

For information on Context Menus, see link:{rootDir}ui-components/contextmenu[UI components - Context menu].

[[spellchecker-plugin]]
=== Spellchecker plugin

link:{rootDir}plugins/spellchecker.html#spellchecker_callback[`spellchecker_callback`] has been updated to remove a legacy format for the `success` callback, which accepted a mapping object of misspelled words to suggestions. For example:

[source,js]
----
spellchecker_callback: function(method, text, success, failure) {
  var words = text.match(this.getWordCharPattern());
  if (method == "spellcheck") {
    var suggestions = {};
    for (var i = 0; i < words.length; i++) {
      suggestions[words[i]] = ["First", "Second"];
    }
    success(suggestions);
  }
}
----

The `success` callback now requires the mapping object to be wrapped in an object with the `words` key, such as:

[source,js]
----
spellchecker_callback: function(method, text, success, failure) {
  var words = text.match(this.getWordCharPattern());
  if (method == "spellcheck") {
    var suggestions = {};
    for (var i = 0; i < words.length; i++) {
      suggestions[words[i]] = ["First", "Second"];
    }
    success({ words: suggestions });
  }
}
----

For information on the `spellchecker_callback` setting, see: link:{rootDir}plugins/spellchecker.html#spellchecker_callback[Spell Checker plugin - spellchecker_callback]

[[table-plugin]]
=== Table plugin

Changes between TinyMCE 4 and TinyMCE 5:

* The text field for Styles have been removed from the advanced tab of the dialogs. This simplifies the dialogs for users and gives the editor a stricter control over the table styles, which ensures that the styles are valid.
* When opening a properties dialog with a single table, row, or cell selected, the dialog will autofill with the relevant existing values. When multiple rows or cells are selected:
 ** If the selected rows or cells have the same values, TinyMCE 5 automatically fills the dialog values.
 ** If the fields have no existing value or have different values, the dialog fields are left empty.
* The `Border` input field in the table properties dialog is now called `Border width`.

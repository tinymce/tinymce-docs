:rootDir: ../
:partialsDir: {rootDir}partials/
include::{rootDir}_attributes.adoc[]
= Comments 2.0
:description: Tiny Comments provides the ability to add comments to the content and collaborate with other users for content editing.
:keywords: comments commenting tinycomments
:title_nav: Comments

{premiumplugin}

The Comments 2.0 plugin provides the ability to start or join a conversation by adding comments to the content within the {productname} editor. The Comments 2.0 plugin is built upon the link:{rootDir}advanced/annotations.html[Annotations API] and uses annotations to create comment threads (conversations).

Comments is a premium plugin from {companyname}. Please see the link:{rootDir}enterprise/tiny-comments.html[Premium features] section for all the buying options.

After obtaining the Comments 2.0 plugin, refer to the following instructions for using it.

[[add-the-comments-2-0-plugin]]
== Add the Comments 2.0 plugin

To add the Comments 2.0 plugin to the {productname} editor, use the following script:

[source,js]
----
tinymce.init({
  selector: '#tiny-ui .editor',
  plugins: 'paste tinycomments',
  tinycomments_mode: 'embedded',
  tinycomments_author: 'Author'
});
----

[[modes]]
== Modes

There are two modes available in Comments 2.0 that provide the ability to save comments. These modes are configured in the Comments 2.0 settings.

* *Callback Mode* - This is the default mode in Comments. This mode is used to configure storage and save comments on the user's server. This option gives the user a choice of configuring the storage settings to either persist comments immediately or save them at the same time as the content. Additional callbacks must be configured to use Comments in callback mode.
* *Embedded Mode* - This mode allows the user to store the comments within the content. No additional callbacks are required to be configured to use this mode.

[[configuring-comments-2-0-callback-mode]]
=== Configuring Comments 2.0 callback mode

Refer to the link:{rootDir}advanced/configuring-comments-callbacks.html[configuring callbacks for comments] section for more information.

[[configuring-comments-2-0-embedded-mode]]
=== Configuring Comments 2.0 embedded mode

To configure Comments 2.0 to use the embedded mode use the following script:

[source,js]
----
tinymce.init({
  selector: "#textarea",
  tinycomments_author: 'embedded_journalist',
  tinycomments_author_name: 'Embedded Journalist',
  tinycomments_mode: 'embedded'
  ...
})
----

[[embedded-mode-options]]
==== Embedded mode options

[[tinycomments_author]]
===== tinycomments_author

This option sets the author id to be used when creating or replying to comments.

*Type:* `String`

*Default Value:* `"Anon"`

[[example]]
====== Example

[source,js]
----
tinymce.init({
  selector: "#textarea",
  tinycomments_author: 'embedded_journalist',
  tinycomments_mode: 'embedded'
})
----

[[tinycomments_author_name]]
===== tinycomments_author_name

[NOTE]
====
Available in Tiny Comments version 2.1 onwards.
====

_Optional_ - This option sets the author's display name to be used when creating or replying to comments. If this option is omitted, then the author id is used instead.

*Type:* `String`

[[example-2]]
====== Example

[source,js]
----
tinymce.init({
  selector: "#textarea",
  tinycomments_author: 'embedded_journalist',
  tinycomments_author_name: 'Embedded Journalist',
  tinycomments_mode: 'embedded'
})
----

[[tinycomments_can_delete]]
===== tinycomments_can_delete

_Optional_ - This option sets the author permissions for _deleting comment conversations_. If the `tinycomments_can_delete` option is not included, the current author (`tinycomments_author`) cannot delete comment conversations created by other authors.

*Type:* `Function`

*Default Function*

[source,js]
----
function (req, done, fail) {
  var allowed = req.comments.length > 0 &&
                req.comments[0].author === <Current_tinycomments_author>;
  done({
    canDelete: allowed
  });
}
----

The following example extends the default behavior to allow the author `<Admin user>` to delete other author's comment conversations by adding `|| currentAuthor === "<Admin user>"`.

[[example-2]]
====== Example

[source,js]
----
var currentAuthor = 'embedded_journalist';

tinymce.init({
  selector: "#textarea",
  tinycomments_author: currentAuthor,
  tinycomments_can_delete: function (req, done, fail) {
    var allowed = req.comments.length > 0 &&
                  req.comments[0].author === currentAuthor;
    done({
      canDelete: allowed || currentAuthor === "<Admin user>"
    });
  }
});
----

[[tinycomments_can_delete_comment]]
===== tinycomments_can_delete_comment

_Optional_ - This option sets the author permissions for _deleting comments_. If the `tinycomments_can_delete_comment` option is not included, the current author (`tinycomments_author`) cannot delete comments added by other authors.

*Type:* `Function`

*Default Function*

[source,js]
----
function (req, done, fail) {
  var allowed = req.comment.author === <Current_tinycomments_author>;
  done({
    canDelete: allowed
  });
}
----

The following example extends the default behavior to allow the author `<Admin user>` to delete other author's comments by adding `|| currentAuthor === "<Admin user>"`.

[[example-2]]
====== Example

[source,js]
----
var currentAuthor = 'embedded_journalist';

tinymce.init({
  selector: "#textarea",
  tinycomments_author: currentAuthor,
  tinycomments_can_delete_comment: function (req, done, fail) {
    var allowed = req.comment.author === currentAuthor;
    done({
      canDelete: allowed || currentAuthor === "<Admin user>"
    });
  }
});
----

[[tinycomments_can_edit_comment]]
===== tinycomments_can_edit_comment

_Optional_ - This option sets the author permissions for _editing comments_. If the `tinycomments_can_edit_comment` option is not included, the current author (`tinycomments_author`) cannot edit comments added by other authors.

*Type:* `Function`

*Default Function*

[source,js]
----
function (req, done, fail) {
  var allowed = req.comment.author === <Current_tinycomments_author>;
  done({
    canEdit: allowed
  });
}
----

The following example extends the default behavior to allow the author `<Admin user>` to edit other author's comments by adding `|| currentAuthor === "<Admin user>"`.

[[example-2]]
====== Example

[source,js]
----
var currentAuthor = 'embedded_journalist';

tinymce.init({
  selector: "#textarea",
  tinycomments_author: currentAuthor,
  tinycomments_can_edit_comment: function (req, done, fail) {
    var allowed = req.comment.author === currentAuthor;
    done({
      canEdit: allowed || currentAuthor === "<Admin user>"
    });
  }
});
----

[[configuring-the-comments-2-0-addcomment-toolbar-button]]
== Configuring the Comments 2.0 addcomment toolbar button

The `addcomment` toolbar button provides the ability to add comments.

The *Add comment* toolbar button is available by default if the toolbar menu is not customized.

In case of a customized toolbar menu, use the following script to configure the Comments 2.0 toolbar button:

[source,js]
----
tinymce.init({
 selector: "#textarea",
 toolbar: 'bold italic underline insertfile | addcomment',
 ...
})
----

*Result*: The *Comments*  image:comment-disabled.png[Comments] toolbar button appears in the toolbar menu. The function of this button is to add comments to the selected text.

[[configuring-the-comments-2-0-showcomments-toolbar-button]]
== Configuring the Comments 2.0 showcomments toolbar button

The `showcomments` toolbar button provides the ability to display comments field for the selected text. It is a toggle button and is used to hide the comments sidebar as well.

Use the following script to configure the Comments 2.0 toolbar button:

[source,js]
----
tinymce.init({
 selector: "#textarea",
 toolbar: 'bold italic underline insertfile | showcomments',
 ...
})
----

*Result*: The *Comments*  image:comment-disabled.png[Comments] toolbar button appears in the toolbar menu. The function of this button is to show comments to for the selected text.

[[configuring-the-comments-2-0-menu-item]]
== Configuring the Comments 2.0 menu item

By default, when Comments 2.0 is added to the plugin list, the default menus will have entries for `addcomment` (Insert Menu), `showcomments` (View Menu), and `deleteallconversations` (File Menu).

For more information on configuring menu items refer to the link:{rootDir}configure/editor-appearance.html#toolbar[toolbar] and link:{rootDir}configure/editor-appearance.html#menu[menu] sections.

Currently, there are three menu items available:

* `addcomment` - Provides the ability to add comments. By default, this option can be accessed through *Insert* \-> *Add comment* menu bar item.
* `showcomments`- Provides the ability to display comments field for the selected text. It is a toggle button and is used to hide the comments as well. By default, this option can be accessed through *View* \-> *Show comment* menu bar item.
* `deleteallconversations`- Provides the ability to delete all the comments in the content. By default, this option can be accessed through *File* \-> *Delete all conversations* menu bar item.

[[configuring-the-commented-text-properties]]
== Configuring the commented text properties

The highlight styles are now a part of the overall content skin and are changed through customizing the skin.

{productname} open source project https://github.com/tinymce/oxide/blob/master/src/less/theme/content/comments/comments.less[oxide] (default skin), defines the variables used for changing the annotation colours.

Refer to the link:{rootDir}advanced/creating-a-skin.html#creatingaskin[documentation] for building a skin using this repo.

For more information on configuring {productname} formats, refer to the link:{rootDir}configure/content-formatting.html#formats[formats] section.

[[using-comments]]
== Using Comments

[[to-add-a-comment]]
=== To add a comment

. Select the text from the desired location in the editor body.
. From the navigation menu, choose *Insert* \-> *Add Comment* or click on the *Comments* image:comment-disabled.png[Comments] toolbar button to add the comment.
. The Comment dialog box appears in the sidebar of the editor instance.
. Type the comment in the box displaying "_Say something..._" suggested text.
. Press *Clear* to delete or *Save* to store the input comment.

*Result*: The selected text will be highlighted as per the configured options. The following screen with the option for editing, deleting, and replying to the comment, will appear.

image::commentedit.png[Delete Conversation]

NOTE: The above procedure can be followed for adding multiple comments to the document.

[[editing-a-comment]]
=== Editing a comment

Follow this procedure to edit a comment.

. Click on this image:3dots.png[3 dots] icon above the comments box to expand the menu.
. Select *Edit* from the menu items.
. The comment field becomes editable. Make the required changes.
. Click *Cancel* to discard or *Save* to store the changes.

[[delete-a-comment]]
=== Delete a comment

Follow this procedure to delete a comment. This option is not available for the first comment in a conversation.

. Click on this image:3dots.png[3 dots] icon above the comments box to expand the menu.
. Select *Delete* from the menu items.
. The following options appear in the comments sidebar: +
image:delete.png[delete comment]
. Click *Cancel* to save or *Delete* to remove the comment from the conversation.

[[delete-conversation]]
=== Delete conversation

This option is only available for the first comment in a conversation. Once the comment is saved, follow this procedure to delete a conversation.

. Click on this image:3dots.png[3 dots] icon above the comments box to expand the menu.
. Select *Delete conversation* from the menu items.
. The following decision dialog box will appear: +
image:decision.png[delete conversation]
. Click *Cancel* to save or *Delete* to remove the conversation.

*Result*: The conversation and all its subsequent comments will be deleted.

[[show-comment]]
=== Show comment

Follow this procedure to display the comments sidebar:

. Place the cursor on the desired text in the editor body:
. From the navigation menu, choose *View* -> *Show Comment* or click on the *Show Comments*image:comment-disabled.png[Comments] toggle toolbar button to display the comment.

*Result*: The comments sidebar will appear and display the corresponding conversation for the highlighted text.

[[delete-all-conversations]]
=== Delete all conversations

Follow this procedure to delete all conversations in the document:

. From the navigation menu, choose *File* \-> *Delete all conversations* option to delete all the comments in a document.
. The following decision dialog box will appear: +
image:decision2.png[Delete all conversations]
. Click *Ok* to remove the all the comments or *Cancel* to dismiss the action.

*Result*: All the comments for the selected document will be deleted.

Check out the link:{rootDir}demo/comments-2[Comments demo] to try this new feature.

[[using-comments-2-0-embedded-mode-with-the-full-page-plugin]]
== Using Comments 2.0 embedded mode with the Full Page plugin

Users have to be cautious when deciding the order in which the plugins are added in the plugins list.

Comments can cause an issue if the link:{rootDir}plugins/fullpage.html[Full Page] plugin `fullpage` appears before Comments 2.0 plugin `tinycomments` in the plugin list, and `tinycomments` is configured to use `embedded mode`.

The order that the plugins appear affects the order that the `getContent` hooks are processed in. This creates an issue with `tinycomments` working as expected since the `fullpage` plugin adds outer `<html>` elements before `tinycomments` adds its comment data. This leads to the comment data being in the wrong place. The consequence of this situation is that when a saved document is re-opened, the comment data is lost (but the highlights are still there).

For a workaround, please ensure that `tinycomments` is listed before `fullpage` in the plugins list. This should result in `tinycomments` working properly.

[[commands]]
== Commands

The Comments plugin provides the following JavaScript commands.

include::{partialsDir}commands/comments-cmds.adoc[]

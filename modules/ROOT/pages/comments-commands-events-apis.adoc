= Commands, Events and APIs for the {pluginname} plugin
:navtitle: Commands, Events and APIs
:description: Information on the commands, events and APIs provided with the comments plugin.
:keywords: comments, commenting, tinycomments
:pluginname: Comments
:plugincode: comments

== Commands

The {pluginname} plugin provides the following {productname} commands.

include::partial$commands/comments-cmds.adoc[]

== Events

include::partial$events/tinycomments-events.adoc[]

=== CommentChange event

include::partial$misc/admon-requires-6.1v.adoc[]

Fired when a comment is added, resolved, deleted, edited, or replied to. Contains the `getEventLog` API for retrieving log of comment changes.

==== Example: the CommentChange event

[source,js]
----
tinymce.init({
  selector: 'textarea',
  plugins: 'tinycomments',
  toolbar: 'addcomment showcomments',
  init_instance_callback: (editor) => {
    editor.on('CommentChange', (evt) => {
      console.log(evt.getEventLog());
    });
  }
});
----

include::partial$plugin-apis/comments-apis.adoc[]

[[tinycomments-annotator]]
=== The `+'tinycomments'+` annotator

The {pluginname} plugin provides an annotator named `+'tinycomments'+`, constructed using the xref:annotations.adoc[`+editor.annotator+` API].

The `+'tinycomments'+` annotator is used to annotate content with conversations attached, and is available for use in each of the `+editor.annotator+` API methods.

The `+'tinycomments'+` annotator, like all editor APIs, can only be accessed after the editor is initialized.

==== Example: using the `+'tinycomments'+` annotator to notify when conversations are selected

This example makes use of the `+annotationChanged+` method in the `+editor.annotator+` API to create a xref:creating-custom-notifications.adoc[custom notification].

The below notification example displays for five seconds every time any content with a `+'tinycomments'+` annotation is selected.

[source,js]
----
tinymce.init({
  selector: 'textarea',
  plugins: 'tinycomments',
  toolbar: 'addcomment showcomments',
  setup: (editor) => {
    editor.on('init', () => {
      editor.annotator.annotationChanged('tinycomments', (selected, annotatorName, context) => {
        if (selected) {
          editor.notificationManager.open({
            text: `The content you have selected contains a conversation. ${annotatorName}: ${context.uid}.`,
            type: 'info',
            timeout: 5000
          });
        }
      });
    });
  }
});
----

==== Example: using the `+'tinycomments'+` annotator to highlight conversations without showing comments

This example makes use of the `+getAll+` method in the `+editor.annotator+` API to highlight every element annotated by `+'tinycomments'+`.

When the `+'highlightcomments'+` button on the toolbar is toggled on, every annotated element is highlighted `+aquamarine+`, without requiring the user to xref:comments-using-comments#show-or-view-a-comment[show comments].

[source,js]
----
tinymce.init({
  selector: 'textarea',
  plugins: 'tinycomments',
  toolbar: 'addcomment showcomments highlightcomments',
  setup: (editor) => {
    editor.ui.registry.addToggleButton('highlightcomments', {
      icon: 'highlight-bg-color',
      onAction: (api) => {
        api.setActive(!api.isActive());
        const conversations = editor.annotator.getAll('tinycomments');
        for (const [conversation, elements] of Object.entries(conversations)) {
          elements.forEach((element, _) => {
            if (api.isActive()) {
              element.style.setProperty('background-color', 'aquamarine');
            } else {
              element.style.removeProperty('background-color');
            }
          });
        }
      }
    });
  }
});
----

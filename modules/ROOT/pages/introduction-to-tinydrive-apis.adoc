= Tiny Drive Plugin API
:description: Description of the Tiny Drive plugin API
:keywords: tinydrive api
:title_nav: Plugin API

The {cloudfilemanager} {productname} plugin has an API that enables access to {cloudfilemanager} from your custom plugins or {productname} specific integration code. This API is available though the `editor.plugins.tinydrive` property.

[[tinydrivepick]]
== `tinydrive.pick`

The `tinydrive.pick` method enables you to pick files from {cloudfilemanager} and get the meta data of those files returned in a promise. For a complete list of available settings to pass in to this method check the xref:pickersettings[Picker settings] section in this page.

=== File Picker Result Format

The `tinydrive.pick` API method will return a promise with object that has a `files` property. This `files` property is an array of files with the following properties.

==== name

The name of the selected file for example `my.jpg`.

==== size

The size in bytes of the selected file.

==== url

The url for the selected file would be in the following format: `+https://drive.tiny.cloud/1/<your api key>/<file uuid>+`

==== mdate

The modification date for the file in ISO 8601 format for example `2019-02-24T15:00:00Z`

=== Interactive example: Using `tinydrive.pick`

liveDemo::drive-plugin-pick[]

[[tinydrivebrowse]]
== `tinydrive.browse`

The `tinydrive.browse` method enables you to browse your files stored in {cloudfilemanager} but without the possibility to pick them to be inserted. This might be useful if you want to use {cloudfilemanager} as a generic file manager. It returns a promise but the promise will only resolve when the {cloudfilemanager} dialog is closed by using the close button. For a complete list of available settings to pass in to this method check the xref:pickersettings[Picker settings] section in this page.

=== Interactive example: Using `tinydrive.browse`

liveDemo::drive-plugin-browse[]

== `tinydrive.upload`

The `tinydrive.upload` method enables directly upload blobs to your {cloudfilemanager} storage. This can be useful when you want to store a file generated by your app.

=== Interactive example: Using `tinydrive.upload`

liveDemo::drive-plugin-upload[]

[[pickersettings]]
== Picker settings

These settings are available for the xref:tinydrivepick[tinydrive.pick] / xref:tinydrivebrowse[tinydrive.browse] API methods.

=== `filetypes`

This setting enables restricting what types of files you want do display based on xref:tinydrive-introduction.adoc#filetypes[file type] categories. For example if your app needs to insert images only then you can specify `['image']` in the file types array.

*Type:* `Array<string>`

==== Interactive example: Using `filetypes`

liveDemo::drive-plugin-pick-images[]

=== `max_image_dimension`

This setting enables constraining the width/height of uploaded images. When this is enabled any images with a higher width or height than the specified amount would be proportionally resized down to the specified maximum dimension.

*Type:* `Number`

==== Example: Using `max_image_dimension`

[source, js]
----
tinydrive.pick({
  max_image_dimension: 1024
}).then(function (result) {
  console.log(result.files);
});
----

=== Plugin API interfaces

Here is a complete API reference as TypeScript types for developers used to TypeScript syntax.

[source,ts]
----
interface PluginApi {
  pick: (settings: PluginPickerApiSettings) => Promise<PickerResult>;
  browse: (settings: PluginPickerApiSettings) => Promise<void>;
  upload: (settings: PluginUploadApiSettings) => Promise<UploadResult>;
}

interface PluginPickerApiSettings {
  filetypes?: string[];
}

interface PluginUploadApiSettings {
  path?: string;
  name: string;
  blob: Blob;
  onprogress?: (details: UploadProgress) => void;
  max_image_dimension?: number;
}

interface DriveFile {
  url: string;
  size: number;
  name: string;
  type: string;
  mdate: string;
}

interface PickerResult {
  files: DriveFile[];
}

interface UploadProgress {
  loaded: number;
  total: number;
}

interface UploadResult {
  file: DriveFile;
}
----

= Revision History Plugin
:navtitle: Revision History
:description: A view that allows {productname} users to see historical snapshots of a document and an ability to restore from a snapshot
:description_short: View containing historical snapshots of a document.
:keywords: plugin, Revision History, history, version, snapshots, restore, changes, revision, diff
:pluginname: Revision History
:plugincode: revisionhistory
:plugincategory: premium

include::partial$misc/admon-revisionhistory-paid-addon-pricing.adoc[]

include::partial$misc/admon-requires-7.0v.adoc[]

The {pluginname} plugin offers users the ability to view document changes over time and restore previous revisions effortlessly.

== Interactive example

liveDemo::{plugincode}[]

include::partial$misc/admon-iframe-only.adoc[]

== How it works

The {pluginname} view is accessible via either the `revisionhistory` toolbar button or menu button within the `View` menu.

The key components are:

1. In the {pluginname} view header, there are two buttons.
* `Restore this version`: Set the selected revision's content to the editor and close the view. Note that this button is disabled for the `initial` and `draft` revisions.
* `Close`: Close the view.

2. The readonly diff view presents the changes between the selected revision and its immediate predecessor, clearly highlighting for easy recognition. The changes are also color-coded for clarity:
* Red: Removed content.
* Green: New content.
* Yellow: Content being modified. Modifications to HTML content implies attributes or formatting (e.g. bold, italic, etc.).
3. The revisions sidebar displays all available document revisions. When a new revision is selected, the diff view is updated accordingly.

[NOTE]
The default highlighting colors can be customized using the xref:revisionhistory_css_url[`+revisionhistory_css_url+`] option.

[NOTE]
The {pluginname} plugin interprets commented HTML as valid content, yet it disregards this content during the revision comparison process. Consequently, a revision containing solely commented content appears as empty in the user interface displaying the differential content.

== Basic setup

To setup the {pluginname} plugin user-interface in the editor:

* add `{plugincode}` to the `plugins` option in the editor configuration;
* add `{plugincode}` to the `toolbar` option in the editor configuration;
* add `{plugincode}_fetch` option to the editor configuration;

For example:

[source,js]
----
tinymce.init({
  selector: 'textarea',  // change this value according to your HTML
  plugins: 'revisionhistory',
  toolbar: 'revisionhistory',
  // Required
  revisionhistory_fetch: () => new Promise((resolve) => {
    const revisions = [];  // Replace this with an API request to get saved revisions
    resolve(revisions);
  })
});
----

== Understanding types of revisions

There are three types of revisions in {pluginname} plugin:

* Initial Revision: This revision is generated during the {productname} `Loaded` event, with the editor's initial content.
* Draft Revision: This revision is generated upon accessing the {pluginname}, reflecting the editor's current content. When included, it becomes the `latest revision` and is placed at the top of the revisions list. Note that the draft revision is not a saved revision.
* Saved Revisions: These revisions are saved in the client's storage and are displayed in the revisions list. They are fetched upon opening the {pluginname} view using the `revisionhistory_fetch` and `revisionhistory_fetch_revision` options.

When dealing with a new document that has no saved revisions, the {pluginname} plugin will typically maintain two revisions: the `initial` and `draft` revisions.

For documents with saved revisions, the `initial` revision is disregarded by the {pluginname} plugin, assuming it's already part of the revisions list.

If there are no changes to the content of the editor since initialization, the `initial` revision is not displayed in the revisions list since it's identical to the `draft` revision.

The table below summarizes how revisions are handled in the {pluginname}:

[cols="1,1,1,3", options="header"]
|===
| Has Initial Revision | Draft Revision | Has Saved Revisions | Expectation
| No                  | N/A           | No                 | No revisions are shown
| No                  | N/A           | Yes                | Only the saved revisions are shown
| Yes                 | N/A           | No                 | Only the draft revision is shown
| Yes                 | Different     | No                 | Both the initial and draft revisions are shown
| Yes                 | N/A           | Yes                | The saved revisions and the draft revision are shown
|===

== The Revision object

The revision object is an `+Object+` that represents a version of the document. It contains the following fields:

[cols="1,1,1,3",options="header"]
|===
| Field          | Type       | Required? | Description
| `+revisionId+` | `+string+` | required  | The unique string ID of the revision.
| `+author+`     | xref:#the-author-object[Author] `+Object+` | optional  | The author of the revision.
| `+createdAt+`  | `+string+` | required  | A UTC datetime string in ISO-8061 format.
| `+content+`    | `+string+` | optional  | HTML string of the revision content. Empty string is considered as valid content.
|===

== The Author object

The author object is an `+Object+` that represents the author of a revision. It contains the following fields:

[cols="1,1,1,3",options="header"]
|===
| Field      | Type       | Required? | Description
| `+id+`     | `+string+` | required  | The unique string ID of the author.
| `+name+`   | `+string+` | optional  | The name of the revision author. If not provided, the default value is `Anonymous`.
| `+avatar+` | `+string+` | optional  | The URL of the author's avatar image. If not provided, the default value is an auto-generated avatar using the author's initials.
|===


== Options

The following configuration options affect the behavior of the {pluginname} plugin.

include::partial$configuration/revisionhistory_fetch.adoc[leveloffset=+1]

include::partial$configuration/revisionhistory_fetch_revision.adoc[leveloffset=+1]

include::partial$configuration/revisionhistory_author.adoc[leveloffset=+1]

include::partial$configuration/revisionhistory_display_author.adoc[leveloffset=+1]

include::partial$configuration/revisionhistory_css_url.adoc[leveloffset=+1]

include::partial$configuration/revisionhistory_diff_classes.adoc[leveloffset=+1]

include::partial$misc/plugin-toolbar-button-id-boilerplate.adoc[]

include::partial$misc/plugin-menu-item-id-boilerplate.adoc[]

== Commands

The {pluginname} plugin provides the following {productname} commands.

include::partial$commands/{plugincode}-cmds.adoc[]

== Events

The {pluginname} plugin provides the following events.

include::partial$events/{plugincode}-events.adoc[]

== APIs

The {pluginname} plugin provide the following APIs.

include::partial$plugin-apis/{plugincode}-apis.adoc[]